<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC
"-//mybatis.org//DTO Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="product">
	<!-- 분류 조회 -->
	<select id="categoryList" resultType="Category">
	<![CDATA[
		SELECT category_id, category_name
		FROM category
		ORDER BY p.category_id ASC;
	]]>
	</select>
	<!-- 상품 전체 조회 -->
	<select id="productlist" resultType="ProductDto">
	<![CDATA[
		SELECT name, price, page, category_name  
		FROM product p, category c 
		WHERE c.category_id = p.category_id
		ORDER BY p.category_id ASC;
	]]>
	</select>
	<!-- 이름으로 검색 -->
	<select id="productSearchName" parameterType="String" resultType="ProductDto">
	<![CDATA[
		SELECT product_name, price, page, category_name  
		FROM product p, category c 
		WHERE c.category_id = p.category_id 
		AND (p.product_id LIKE ‘%’ || #{searchText} || ‘%’
		OR p.name LIKE ‘%’ || #{searchText} || ‘%’)
		ORDER BY p.category_id ASC;
	]]>
	</select>
	<!-- 분류로 검색 -->
	<select id="productSearchCategory" parameterType="String" resultType="ProductDto">
	<![CDATA[
		SELECT product_name, price, manufacture_name, category_name  
		FROM product p, category c 
		WHERE c.category_id = p.category_id
		AND p.category_id = #{category_id};
	]]>
	</select>
	<!-- 둘 다 사용하여 검색 -->
	<select id="productSearchDual" parameterType="String" resultType="ProductDto">
	<![CDATA[
		SELECT product_name, price, manufacture_name, category_name  
		FROM product p, category c 
		WHERE c.category_id = p.category_id
		AND (p.product_id LIKE ‘%’ || #{searchText} || ‘%’
		OR p.name LIKE ‘%’ || #{searchText} || ‘%’)
		AND p.category_id = #{category_id};
	]]>
	</select>
	<!-- 상품 세부정보 -->
	<select id="productInfo" parameterType="String" resultType="ProductDto">
	<![CDATA[
		SELECT product_name, category_name, page, description, manufacture_name, price  
		FROM product p, category c 
		WHERE c.category_id = p.category_id 
		AND product_id LIKE #{product_id};
	]]>
	</select>
	<!-- 여기까지가 사용자 화면 관련 -->
	
	<!-- 관리자 재고조회 리스트 -->
	<select id = "inventoryList" resultType="ProductDto">
	<![CDATA[
		SELECT p.product_id, product_name, product_price, state, manufacture_name, manufacture_address, p.category_id, category_name, quantity
		FROM product p, category c, inventory i
		WHERE c.category_id = p.category_id AND p.product_id = i.product_id
		ORDER BY p.category_id ASC;
		
	]]>
	</select>
	<!-- 이름으로 재고 조회 -->
	<select id = "inventorySearchName" parameterType="String" resultType="ProductDto">
	<![CDATA[
		SELECT p.product_id, product_name, product_price, state, manufacture_name, manufacture_address, p.category_id, category_name, quantity
		FROM product p, category c, inventory i
		WHERE (c.category_id = p.category_id AND p.product_id = i.product_id)
		AND (p.product_id LIKE ‘%’ || #{searchText} || ‘%’
		OR p.product_name LIKE ‘%’ || #{searchText} || ‘%’)
		ORDER BY p.category_id ASC;
	]]>
	</select>
	<!-- 개수를 변경 -->
	<insert id = "updateQuantity" parameterType="Inventory">
	<![CDATA[
		UPDATE quantity 
		SET #{number} 
		FROM product p, inventory i 
		WHERE p.product_id = i.product_id
		AND p.product_id LIKE #{product_id};
	]]>
	</insert>
	<!-- 상품 상태를 받아옴, 사용자에게 상품 구매 불가인지 아닌지를 출력하기위해 작성 -->
	<select id = "productState" parameterType="String" resultType="String">
	<![CDATA[
		SELECT state 
		FROM product 
		WHERE product_id LIKE #{product_id};
	]]>
	</select>
</mapper>